drop table if exists recent_day_count_road_4_1; create table recent_day_count_road_4_1 as select Card_id, count(*) as day_count_1 from gd_train_data_4 where deal_time>='2014122305' and deal_time<'2014122405' group by Card_id;drop table if exists recent_day_count_road_4_2; create table recent_day_count_road_4_2 as select Card_id, count(*) as day_count_2 from gd_train_data_4 where deal_time>='2014122205' and deal_time<'2014122405' group by Card_id;drop table if exists recent_day_count_road_4_3; create table recent_day_count_road_4_3 as select Card_id, count(*) as day_count_3 from gd_train_data_4 where deal_time>='2014122105' and deal_time<'2014122405' group by Card_id;drop table if exists recent_day_count_road_4_4; create table recent_day_count_road_4_4 as select Card_id, count(*) as day_count_4 from gd_train_data_4 where deal_time>='2014122005' and deal_time<'2014122405' group by Card_id;drop table if exists recent_day_count_road_4_5; create table recent_day_count_road_4_5 as select Card_id, count(*) as day_count_5 from gd_train_data_4 where deal_time>='2014121905' and deal_time<'2014122405' group by Card_id;drop table if exists recent_day_count_road_4_6; create table recent_day_count_road_4_6 as select Card_id, count(*) as day_count_6 from gd_train_data_4 where deal_time>='2014121805' and deal_time<'2014122405' group by Card_id;drop table if exists recent_day_count_road_4_7; create table recent_day_count_road_4_7 as select Card_id, count(*) as day_count_7 from gd_train_data_4 where deal_time>='2014121705' and deal_time<'2014122405' group by Card_id;drop table if exists recent_day_count_road_4_10; create table recent_day_count_road_4_10 as select Card_id, count(*) as day_count_10 from gd_train_data_4 where deal_time>='2014121405' and deal_time<'2014122405' group by Card_id;drop table if exists recent_day_count_road_4_15; create table recent_day_count_road_4_15 as select Card_id, count(*) as day_count_15 from gd_train_data_4 where deal_time>='2014120905' and deal_time<'2014122405' group by Card_id;drop table if exists recent_day_count_road_4_30; create table recent_day_count_road_4_30 as select Card_id, count(*) as day_count_30 from gd_train_data_4 where deal_time>='2014112405' and deal_time<'2014122405' group by Card_id;drop table if exists recent_day_count_road_4_60; create table recent_day_count_road_4_60 as select Card_id, count(*) as day_count_60 from gd_train_data_4 where deal_time>='2014102505' and deal_time<'2014122405' group by Card_id;drop table if exists recent_day_count_road_4_365; create table recent_day_count_road_4_365 as select Card_id, count(*) as day_count_365 from gd_train_data_4 where deal_time>='2013122405' and deal_time<'2014122405' group by Card_id;

drop table if exists recent_day_count_road_4; create table recent_day_count_road_4 as select gd_train_data_4.card_id, recent_day_count_road_4_1.day_count_1 as day_count_1, recent_day_count_road_4_2.day_count_2 as day_count_2, recent_day_count_road_4_3.day_count_3 as day_count_3, recent_day_count_road_4_4.day_count_4 as day_count_4, recent_day_count_road_4_5.day_count_5 as day_count_5, recent_day_count_road_4_6.day_count_6 as day_count_6, recent_day_count_road_4_7.day_count_7 as day_count_7, recent_day_count_road_4_10.day_count_10 as day_count_10, recent_day_count_road_4_15.day_count_15 as day_count_15, recent_day_count_road_4_30.day_count_30 as day_count_30, recent_day_count_road_4_60.day_count_60 as day_count_60, recent_day_count_road_4_365.day_count_365 as day_count_365 from gd_train_data_4 left outer join recent_day_count_road_4_1 on gd_train_data_4.card_id=recent_day_count_road_4_1.card_id  left outer join recent_day_count_road_4_2 on gd_train_data_4.card_id=recent_day_count_road_4_2.card_id  left outer join recent_day_count_road_4_3 on gd_train_data_4.card_id=recent_day_count_road_4_3.card_id  left outer join recent_day_count_road_4_4 on gd_train_data_4.card_id=recent_day_count_road_4_4.card_id  left outer join recent_day_count_road_4_5 on gd_train_data_4.card_id=recent_day_count_road_4_5.card_id  left outer join recent_day_count_road_4_6 on gd_train_data_4.card_id=recent_day_count_road_4_6.card_id  left outer join recent_day_count_road_4_7 on gd_train_data_4.card_id=recent_day_count_road_4_7.card_id  left outer join recent_day_count_road_4_10 on gd_train_data_4.card_id=recent_day_count_road_4_10.card_id  left outer join recent_day_count_road_4_15 on gd_train_data_4.card_id=recent_day_count_road_4_15.card_id  left outer join recent_day_count_road_4_30 on gd_train_data_4.card_id=recent_day_count_road_4_30.card_id  left outer join recent_day_count_road_4_60 on gd_train_data_4.card_id=recent_day_count_road_4_60.card_id  left outer join recent_day_count_road_4_365 on gd_train_data_4.card_id=recent_day_count_road_4_365.card_id ;

drop table if exists positive_set_road_4; create table positive_set_road_4 as select distinct(card_id) from gd_train_data_4 where deal_time>='2014122505' and deal_time<'2015010105';

drop table if exists train_alluser_set_road_4; create table train_alluser_set_road_4 as select distinct(card_id) from gd_train_data_4 where deal_time>='2014080105' and deal_time<'2014122505';

drop table if exists label_road_4; create table label_road_4 as select train_alluser_set_road_4.card_id,regexp_replace(length(positive_set_road_4.card_id) as string,'32','1') as label from train_alluser_set_road_4 left outer join positive_set_road_4 on train_alluser_set_road_4.card_id=positive_set_road_4.card_id;

drop table if exists test_data_road_4; create table test_data_road_4 as select recent_day_count_road_4.*,label_road_4.label from label_road_4 left outer join recent_day_count_road_4 on label_road_4.card_id=recent_day_count_road_4.card_id;

